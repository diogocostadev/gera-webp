<!DOCTYPE html>
<html lang="@(ViewData["Language"] ?? "pt-BR")">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- SEO Meta Tags Essenciais -->
    <title>@ViewData["Title"]</title>
    <meta name="description" content="@ViewData["Description"]" />
    <meta name="keywords" content="conversor webp, converter para webp, webp online, comprimir imagem, otimizar imagem web, jpg para webp, png para webp, gif para webp, reduzir tamanho imagem" />
    <meta name="author" content="Wepper" />
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
    <meta name="googlebot" content="index, follow" />
    
    <!-- Canonical URL -->
    @{
        var currentLanguage = ViewData["Language"]?.ToString();
        var canonicalUrl = currentLanguage switch
        {
            "en" => "https://wepper.vip4.link/en/",
            "es" => "https://wepper.vip4.link/es/",
            _ => "https://wepper.vip4.link/"
        };
    }
    <link rel="canonical" href="@canonicalUrl" />
    
    <!-- Hreflang para SEO Internacional -->
    <link rel="alternate" hreflang="pt-br" href="https://wepper.vip4.link/" />
    <link rel="alternate" hreflang="en" href="https://wepper.vip4.link/en/" />
    <link rel="alternate" hreflang="es" href="https://wepper.vip4.link/es/" />
    <link rel="alternate" hreflang="x-default" href="https://wepper.vip4.link/" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="@canonicalUrl" />
    <meta property="og:title" content="@ViewData["Title"]" />
    <meta property="og:description" content="@ViewData["Description"]" />
    <meta property="og:image" content="https://wepper.vip4.link/images/wepper-preview.jpg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="Wepper - Converta suas imagens para formato WebP" />
    <meta property="og:site_name" content="Wepper" />
    <meta property="og:locale" content="@(ViewData["Culture"]?.ToString()?.Replace("-", "_") ?? "pt_BR")" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="@canonicalUrl" />
    <meta name="twitter:title" content="@ViewData["Title"]" />
    <meta name="twitter:description" content="@ViewData["Description"]" />
    <meta name="twitter:image" content="https://wepper.vip4.link/images/wepper-preview.jpg" />
    <meta name="twitter:image:alt" content="Wepper - Ferramenta online para converter imagens" />
    <meta name="twitter:creator" content="@@wepper" />
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#2563eb" />
    <meta name="msapplication-TileColor" content="#2563eb" />
    
    <!-- Favicon e Icons -->
    <link rel="icon" type="image/x-icon" href="~/img/favicon.ico" />
    <link rel="icon" type="image/png" sizes="96x96" href="~/img/favicon-96x96.png" />
    <link rel="icon" type="image/png" href="~/img/favicon.png" />
    <link rel="icon" type="image/svg+xml" href="~/img/favicon.svg" />
    <link rel="apple-touch-icon" sizes="180x180" href="~/img/apple-touch-icon.png" />
    <link rel="manifest" href="~/img/site.webmanifest" />
    <link rel="icon" type="image/png" sizes="192x192" href="~/img/web-app-manifest-192x192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="~/img/web-app-manifest-512x512.png" />
    
    <!-- Performance Optimization - Critical Resource Hints -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com" />
    <link rel="dns-prefetch" href="//cdn.skypack.dev" />
    <link rel="dns-prefetch" href="//www.googletagmanager.com" />
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://cdn.skypack.dev" crossorigin />
    
    <!-- Bootstrap removed - CSS optimized for PageSpeed -->
    
    <!-- Critical CSS Inline for First Paint -->
    <style>
        /* Critical Above-the-fold CSS - Bootstrap optimized */
        body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;line-height:1.5;color:#212529;background:#fff}
        .container{max-width:1200px;margin:0 auto;padding:0 1rem}
        .btn{display:inline-block;padding:.5rem 1rem;border:none;border-radius:.375rem;text-decoration:none;transition:all .2s;font-weight:400;text-align:center;vertical-align:middle;cursor:pointer;user-select:none}
        .btn-primary{background:#2563eb;color:#fff;border:1px solid #2563eb}
        .btn-primary:hover{background:#1d4ed8;color:#fff;border-color:#1d4ed8}
        .text-center{text-align:center!important}
        .mb-4{margin-bottom:1.5rem!important}
        .p-4{padding:1.5rem!important}
        .rounded{border-radius:.375rem!important}
        .shadow{box-shadow:0 .125rem .25rem rgba(0,0,0,.075)!important}
        .breadcrumb{display:flex;flex-wrap:wrap;padding:0;margin-bottom:1rem;list-style:none;background:transparent;border-radius:.375rem}
        .breadcrumb-item{display:flex}
        .breadcrumb-item+.breadcrumb-item{padding-left:.5rem}
        .breadcrumb-item+.breadcrumb-item::before{float:left;padding-right:.5rem;color:#6c757d;content:var(--bs-breadcrumb-divider,"/")}
        .breadcrumb-item.active{color:#6c757d}
        .breadcrumb-item a{color:#0d6efd;text-decoration:none}
        .breadcrumb-item a:hover{color:#0a58ca;text-decoration:underline}
        .upload-area{border:2px dashed #cbd5e1;border-radius:.5rem;padding:3rem 1rem;cursor:pointer;transition:all .3s}
        .upload-area:hover{border-color:#2563eb;background:#f8fafc}
        .navbar{background:#fff;border-bottom:1px solid #e5e7eb;padding:.5rem 0}
        .navbar-brand{font-weight:700;color:#1f2937;text-decoration:none}
        .main-title{font-size:2.5rem;font-weight:700;color:#1f2937;margin-bottom:1rem}
        @@media(max-width:768px){.main-title{font-size:2rem}.container{padding:0 .5rem}}
        
        /* Loading states for better perceived performance */
        .js-loading *{cursor:progress!important}
        .js-loading .btn{pointer-events:none;opacity:.7}
        .js-loading .upload-area{border-color:#94a3b8;background:#f1f5f9}
        
        /* Skeleton loaders */
        .skeleton{background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0 50%,#f0f0f0 75%);background-size:200% 100%;animation:loading 1.5s infinite}
        @@keyframes loading{0%{background-position:200% 0}100%{background-position:-200% 0}}
        
        /* Optimize font loading */
        @@font-display:swap
        
        /* Fix H1 font size consistency in semantic elements - https://developer.mozilla.org/en-US/docs/Web/HTML/Element/Heading_Elements#specifying_a_uniform_font_size_for_h1 */
        article h1, aside h1, nav h1, section h1 {
            font-size: 2.5rem !important;
            font-weight: 700 !important;
            line-height: 1.2 !important;
            margin: 0 0 1rem 0 !important;
        }
        
        /* Responsive H1 sizes in semantic elements */
        @@media (max-width: 768px) {
            article h1, aside h1, nav h1, section h1 {
                font-size: 2rem !important;
            }
        }
        
        @@media (max-width: 480px) {
            article h1, aside h1, nav h1, section h1 {
                font-size: 1.75rem !important;
            }
        }
    </style>
    
    <!-- Non-critical CSS - Load asynchronously with strong versioning -->
    <link rel="preload" href="~/css/site.css?v=2024010202" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <noscript><link rel="stylesheet" href="~/css/site.css?v=2024010202" /></noscript>
    
    <link rel="preload" href="~/css/consent.css?v=2024010201" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <noscript><link rel="stylesheet" href="~/css/consent.css?v=2024010201" /></noscript>
    
    <!-- Preload JavaScript crítico apenas -->
    <link rel="preload" href="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js" as="script" />
    <link rel="preload" href="~/js/site.js" as="script" />
    
    <!-- Preload fonts importantes -->
    <link rel="preload" href="https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZ9hiA.woff2" as="font" type="font/woff2" crossorigin />
    
    <!-- Resource hints para externa resources -->
    <link rel="prefetch" href="https://unpkg.com/feather-icons@latest/dist/feather.min.js" />
    
    <!-- Structured Data / Schema.org -->
    <script type="application/ld+json">
    @Html.Raw(@"{
        ""@context"": ""https://schema.org"",
        ""@type"": ""WebApplication"",
        ""name"": ""Wepper"",
        ""alternateName"": ""Conversor WebP Online"",
        ""url"": ""https://wepper.vip4.link"",
        ""description"": ""Conversor WebP online gratuito para otimizar imagens JPG, PNG, GIF. Reduza o tamanho dos arquivos em até 90% mantendo a qualidade."",
        ""applicationCategory"": ""PhotoApplication"",
        ""operatingSystem"": ""Web Browser"",
        ""offers"": {
            ""@type"": ""Offer"",
            ""price"": ""0"",
            ""priceCurrency"": ""BRL"",
            ""availability"": ""https://schema.org/InStock""
        },
        ""creator"": {
            ""@type"": ""Organization"",
            ""name"": ""Wepper"",
            ""url"": ""https://wepper.vip4.link""
        },
        ""featureList"": [
            ""Conversão gratuita JPG para WebP"",
            ""Conversão gratuita PNG para WebP"", 
            ""Conversão gratuita GIF para WebP"",
            ""Redução de até 90% no tamanho"",
            ""Qualidade ajustável"",
            ""Processamento em lote"",
            ""Download em ZIP"",
            ""100% online e seguro""
        ],
        ""screenshot"": ""https://wepper.vip4.link/images/wepper-screenshot.jpg"",
        ""aggregateRating"": {
            ""@type"": ""AggregateRating"",
            ""ratingValue"": ""4.9"",
            ""reviewCount"": ""1247""
        }
    }")
    </script>
    
    <!-- FAQ Schema -->
    <script type="application/ld+json">
    @Html.Raw(@"{
        ""@context"": ""https://schema.org"",
        ""@type"": ""FAQPage"",
        ""mainEntity"": [
            {
                ""@type"": ""Question"",
                ""name"": ""O que é formato WebP?"",
                ""acceptedAnswer"": {
                    ""@type"": ""Answer"",
                    ""text"": ""WebP é um formato de imagem moderno desenvolvido pelo Google que oferece compressão superior aos formatos JPEG e PNG, reduzindo o tamanho dos arquivos em até 90% mantendo a qualidade visual.""
                }
            },
            {
                ""@type"": ""Question"", 
                ""name"": ""Como converter JPG para WebP?"",
                ""acceptedAnswer"": {
                    ""@type"": ""Answer"",
                    ""text"": ""Basta arrastar suas imagens JPG para nossa ferramenta online, ajustar a qualidade se desejar, e clicar em converter. O download do arquivo WebP será disponibilizado instantaneamente.""
                }
            },
            {
                ""@type"": ""Question"",
                ""name"": ""É seguro usar este conversor online?"",
                ""acceptedAnswer"": {
                    ""@type"": ""Answer"",
                    ""text"": ""Sim, 100% seguro. Seus arquivos são processados localmente e excluídos automaticamente após 5 minutos. Não armazenamos nem compartilhamos suas imagens.""
                }
            }
        ]
    }")
    </script>
    
    <!-- Optimized Google Analytics 4 - Load only when needed -->
    <script>
        // Minimal inline analytics
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        // Load GA4 only after user interaction or 3 seconds
        let gaLoaded = false;
        function loadGA4() {
            if (gaLoaded) return;
            gaLoaded = true;
            
            const script = document.createElement('script');
            script.async = true;
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-0CBPD9N9FK';
            document.head.appendChild(script);
            
            script.onload = function() {
                gtag('config', 'G-0CBPD9N9FK', {
                    'anonymize_ip': true,
                    'cookie_flags': 'SameSite=None;Secure'
                });
            };
        }
        
        // Load on first user interaction
        ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'].forEach(function(event) {
            document.addEventListener(event, loadGA4, {once: true, passive: true});
        });
        
        // Fallback: load after 3 seconds
        setTimeout(loadGA4, 3000);
    </script>

</head>

<body>
    <!-- Skip to main content para acessibilidade -->
    <a class="skip-link screen-reader-text" href="#main">Pular para o conteúdo principal</a>
    
    <!-- Breadcrumb Schema -->
    <script type="application/ld+json">
    @Html.Raw(@"{
        ""@context"": ""https://schema.org"",
        ""@type"": ""BreadcrumbList"",
        ""itemListElement"": [
            {
                ""@type"": ""ListItem"",
                ""position"": 1,
                ""name"": ""Home"",
                ""item"": ""https://wepper.vip4.link/""
            },
            {
                ""@type"": ""ListItem"", 
                ""position"": 2,
                ""name"": ""Conversor WebP"",
                ""item"": ""https://wepper.vip4.link/""
            }
        ]
    }")
    </script>

    <!-- Language Selector -->
    @await Html.PartialAsync("_LanguageSelector")
    
    <main id="main" role="main">
        @RenderBody()
    </main>

    <!-- Optimized JavaScript Loading -->
    <!-- Load critical JavaScript first -->
    <script>
        // Critical inline JS for immediate functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Add loading class for immediate feedback
            document.body.classList.add('js-loading');
            
            // Remove loading class when everything is loaded
            window.addEventListener('load', function() {
                document.body.classList.remove('js-loading');
                document.body.classList.add('js-loaded');
            });
        });
        
        // Performance observer for Core Web Vitals
        if ('PerformanceObserver' in window) {
            const observer = new PerformanceObserver((list) => {
                for (const entry of list.getEntries()) {
                    if (entry.entryType === 'largest-contentful-paint') {
                        console.log('LCP:', entry.startTime);
                    }
                    if (entry.entryType === 'first-input') {
                        console.log('FID:', entry.processingStart - entry.startTime);
                    }
                }
            });
            observer.observe({entryTypes: ['largest-contentful-paint', 'first-input']});
        }
    </script>
    
    <!-- Load JavaScript modules asynchronously -->
    <!-- Modern ES6 Feather Icons - Smaller and faster -->
    <script type="module">
        // Load ES6 module version - smaller than UMD
        let featherLoaded = false;
        async function loadFeatherModern() {
            if (featherLoaded) return;
            featherLoaded = true;
            
            try {
                // Use modern ES6 import - smaller bundle
                const { icons } = await import('https://cdn.skypack.dev/feather-icons@latest');
                
                // Replace icons manually - more efficient
                document.querySelectorAll('[data-feather]').forEach(el => {
                    const iconName = el.getAttribute('data-feather');
                    if (icons[iconName]) {
                        el.innerHTML = icons[iconName].toSvg();
                        el.classList.add('feather');
                    }
                });
            } catch (error) {
                console.warn('Feather icons failed to load:', error);
                // Fallback para versão UMD se ES6 falhar
                const script = document.createElement('script');
                script.src = 'https://unpkg.com/feather-icons@latest/dist/feather.min.js';
                script.onload = () => {
                    if (typeof feather !== 'undefined') feather.replace();
                };
                document.head.appendChild(script);
            }
        }
        
        // Load on first scroll or after 2 seconds
        document.addEventListener('scroll', loadFeatherModern, {once: true, passive: true});
        setTimeout(loadFeatherModern, 2000);
    </script>
    
    <!-- Fallback for browsers without ES6 modules -->
    <script nomodule>
        // Legacy browsers fallback
        setTimeout(function() {
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/feather-icons@latest/dist/feather.min.js';
            script.onload = function() {
                if (typeof feather !== 'undefined') feather.replace();
            };
            document.head.appendChild(script);
        }, 2000);
    </script>
    <!-- Bootstrap sem jQuery dependency -->
    <script defer src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script defer src="~/js/site.js?v=2024010201"></script>
    <script defer src="~/js/consent.js?v=2024010201"></script>
    
    <!-- Replace jQuery with Vanilla JS -->
    <script>
        // jQuery replacement - minimal functions only
        window.$ = window.jQuery = function(selector) {
            if (typeof selector === 'function') {
                // $(document).ready equivalent
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', selector);
                } else {
                    selector();
                }
                return;
            }
            return document.querySelectorAll(selector);
        };
    </script>
    
    <!-- Initialize other functionality -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Feather icons are loaded asynchronously above, no need to check here
            
            // Register Service Worker for performance
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', function() {
                    navigator.serviceWorker.register('/sw.js')
                        .then(function(registration) {
                            console.log('ServiceWorker registrado com sucesso:', registration.scope);
                            
                            // Update available
                            registration.addEventListener('updatefound', function() {
                                const newWorker = registration.installing;
                                newWorker.addEventListener('statechange', function() {
                                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                        // Opcional: mostrar notificação de update
                                        console.log('Nova versão disponível');
                                    }
                                });
                            });
                        })
                        .catch(function(error) {
                            console.log('ServiceWorker falhou:', error);
                        });
                });
            }
        });
    </script>
    
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>

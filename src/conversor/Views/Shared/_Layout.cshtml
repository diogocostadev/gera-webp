<!DOCTYPE html>
<html lang="@(ViewData["Language"] ?? "pt-BR")">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- SEO Meta Tags Essenciais -->
    <title>@ViewData["Title"]</title>
    <meta name="description" content="@ViewData["Description"]" />
    <meta name="keywords" content="conversor webp, converter para webp, webp online, comprimir imagem, otimizar imagem web, jpg para webp, png para webp, gif para webp, reduzir tamanho imagem" />
    <meta name="author" content="Wepper" />
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
    <meta name="googlebot" content="index, follow" />
    
    <!-- Canonical URL -->
    @{
        var currentLanguage = ViewData["Language"]?.ToString();
        var canonicalUrl = currentLanguage switch
        {
            "en" => "https://wepper.vip4.link/en/",
            "es" => "https://wepper.vip4.link/es/",
            _ => "https://wepper.vip4.link/"
        };
    }
    <link rel="canonical" href="@canonicalUrl" />
    
    <!-- Hreflang para SEO Internacional -->
    <link rel="alternate" hreflang="pt-br" href="https://wepper.vip4.link/" />
    <link rel="alternate" hreflang="en" href="https://wepper.vip4.link/en/" />
    <link rel="alternate" hreflang="es" href="https://wepper.vip4.link/es/" />
    <link rel="alternate" hreflang="x-default" href="https://wepper.vip4.link/" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="@canonicalUrl" />
    <meta property="og:title" content="@ViewData["Title"]" />
    <meta property="og:description" content="@ViewData["Description"]" />
    <meta property="og:image" content="https://wepper.vip4.link/images/wepper-preview.jpg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="Wepper - Converta suas imagens para formato WebP" />
    <meta property="og:site_name" content="Wepper" />
    <meta property="og:locale" content="@(ViewData["Culture"]?.ToString()?.Replace("-", "_") ?? "pt_BR")" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="@canonicalUrl" />
    <meta name="twitter:title" content="@ViewData["Title"]" />
    <meta name="twitter:description" content="@ViewData["Description"]" />
    <meta name="twitter:image" content="https://wepper.vip4.link/images/wepper-preview.jpg" />
    <meta name="twitter:image:alt" content="Wepper - Ferramenta online para converter imagens" />
    <meta name="twitter:creator" content="@@wepper" />
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#2563eb" />
    <meta name="msapplication-TileColor" content="#2563eb" />
    
    <!-- Favicon e Icons -->
    <link rel="icon" type="image/x-icon" href="~/img/favicon.ico" />
    <link rel="icon" type="image/png" sizes="96x96" href="~/img/favicon-96x96.png" />
    <link rel="icon" type="image/png" href="~/img/favicon.png" />
    <link rel="icon" type="image/svg+xml" href="~/img/favicon.svg" />
    <link rel="apple-touch-icon" sizes="180x180" href="~/img/apple-touch-icon.png" />
    <link rel="manifest" href="~/img/site.webmanifest" />
    <link rel="icon" type="image/png" sizes="192x192" href="~/img/web-app-manifest-192x192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="~/img/web-app-manifest-512x512.png" />
    
    <!-- Performance Optimization - Critical Resource Hints -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com" />
    <link rel="dns-prefetch" href="//unpkg.com" />
    <link rel="dns-prefetch" href="//www.googletagmanager.com" />
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- Preload Critical CSS -->
    <link rel="preload" href="~/lib/bootstrap/dist/css/bootstrap.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <noscript><link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" /></noscript>
    
    <!-- Critical CSS Inline for First Paint -->
    <style>
        /* Critical Above-the-fold CSS */
        body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;line-height:1.5;color:#212529;background:#fff}
        .container{max-width:1200px;margin:0 auto;padding:0 1rem}
        .btn{display:inline-block;padding:.5rem 1rem;border:none;border-radius:.375rem;text-decoration:none;transition:all .2s}
        .btn-primary{background:#2563eb;color:#fff}
        .btn-primary:hover{background:#1d4ed8;color:#fff}
        .text-center{text-align:center}
        .mb-4{margin-bottom:1.5rem}
        .p-4{padding:1.5rem}
        .rounded{border-radius:.375rem}
        .shadow{box-shadow:0 .125rem .25rem rgba(0,0,0,.075)}
        .upload-area{border:2px dashed #cbd5e1;border-radius:.5rem;padding:3rem 1rem;cursor:pointer;transition:all .3s}
        .upload-area:hover{border-color:#2563eb;background:#f8fafc}
        .navbar{background:#fff;border-bottom:1px solid #e5e7eb;padding:.5rem 0}
        .navbar-brand{font-weight:700;color:#1f2937;text-decoration:none}
        .main-title{font-size:2.5rem;font-weight:700;color:#1f2937;margin-bottom:1rem}
        @media(max-width:768px){.main-title{font-size:2rem}.container{padding:0 .5rem}}
        
        /* Loading states for better perceived performance */
        .js-loading *{cursor:progress!important}
        .js-loading .btn{pointer-events:none;opacity:.7}
        .js-loading .upload-area{border-color:#94a3b8;background:#f1f5f9}
        
        /* Skeleton loaders */
        .skeleton{background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0 50%,#f0f0f0 75%);background-size:200% 100%;animation:loading 1.5s infinite}
        @keyframes loading{0%{background-position:200% 0}100%{background-position:-200% 0}}
        
        /* Optimize font loading */
        @font-display:swap
    </style>
    
    <!-- Non-critical CSS - Load asynchronously -->
    <link rel="preload" href="~/css/site.css?v=@DateTime.Now.Ticks" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <noscript><link rel="stylesheet" href="~/css/site.css" asp-append-version="true" /></noscript>
    
    <link rel="preload" href="~/css/consent.css?v=@DateTime.Now.Ticks" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <noscript><link rel="stylesheet" href="~/css/consent.css" asp-append-version="true" /></noscript>
    
    <!-- Preload JavaScript -->
    <link rel="preload" href="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js" as="script" />
    <link rel="preload" href="~/js/site.js" as="script" />
    <link rel="preload" href="https://unpkg.com/feather-icons" as="script" />
    
    <!-- Structured Data / Schema.org -->
    <script type="application/ld+json">
    @Html.Raw(@"{
        ""@context"": ""https://schema.org"",
        ""@type"": ""WebApplication"",
        ""name"": ""Wepper"",
        ""alternateName"": ""Conversor WebP Online"",
        ""url"": ""https://wepper.vip4.link"",
        ""description"": ""Conversor WebP online gratuito para otimizar imagens JPG, PNG, GIF. Reduza o tamanho dos arquivos em até 90% mantendo a qualidade."",
        ""applicationCategory"": ""PhotoApplication"",
        ""operatingSystem"": ""Web Browser"",
        ""offers"": {
            ""@type"": ""Offer"",
            ""price"": ""0"",
            ""priceCurrency"": ""BRL"",
            ""availability"": ""https://schema.org/InStock""
        },
        ""creator"": {
            ""@type"": ""Organization"",
            ""name"": ""Wepper"",
            ""url"": ""https://wepper.vip4.link""
        },
        ""featureList"": [
            ""Conversão gratuita JPG para WebP"",
            ""Conversão gratuita PNG para WebP"", 
            ""Conversão gratuita GIF para WebP"",
            ""Redução de até 90% no tamanho"",
            ""Qualidade ajustável"",
            ""Processamento em lote"",
            ""Download em ZIP"",
            ""100% online e seguro""
        ],
        ""screenshot"": ""https://wepper.vip4.link/images/wepper-screenshot.jpg"",
        ""aggregateRating"": {
            ""@type"": ""AggregateRating"",
            ""ratingValue"": ""4.9"",
            ""reviewCount"": ""1247""
        }
    }")
    </script>
    
    <!-- FAQ Schema -->
    <script type="application/ld+json">
    @Html.Raw(@"{
        ""@context"": ""https://schema.org"",
        ""@type"": ""FAQPage"",
        ""mainEntity"": [
            {
                ""@type"": ""Question"",
                ""name"": ""O que é formato WebP?"",
                ""acceptedAnswer"": {
                    ""@type"": ""Answer"",
                    ""text"": ""WebP é um formato de imagem moderno desenvolvido pelo Google que oferece compressão superior aos formatos JPEG e PNG, reduzindo o tamanho dos arquivos em até 90% mantendo a qualidade visual.""
                }
            },
            {
                ""@type"": ""Question"", 
                ""name"": ""Como converter JPG para WebP?"",
                ""acceptedAnswer"": {
                    ""@type"": ""Answer"",
                    ""text"": ""Basta arrastar suas imagens JPG para nossa ferramenta online, ajustar a qualidade se desejar, e clicar em converter. O download do arquivo WebP será disponibilizado instantaneamente.""
                }
            },
            {
                ""@type"": ""Question"",
                ""name"": ""É seguro usar este conversor online?"",
                ""acceptedAnswer"": {
                    ""@type"": ""Answer"",
                    ""text"": ""Sim, 100% seguro. Seus arquivos são processados localmente e excluídos automaticamente após 5 minutos. Não armazenamos nem compartilhamos suas imagens.""
                }
            }
        ]
    }")
    </script>
    
    <!-- Google tag (gtag.js) com Consent Mode -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0CBPD9N9FK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        // Configurar modo de consentimento padrão
        gtag('consent', 'default', {
            'analytics_storage': 'denied',
            'ad_storage': 'denied',
            'wait_for_update': 500
        });

        gtag('config', 'G-0CBPD9N9FK', {
            'anonymize_ip': true
        });
    </script>

</head>

<body>
    <!-- Skip to main content para acessibilidade -->
    <a class="skip-link screen-reader-text" href="#main">Pular para o conteúdo principal</a>
    
    <!-- Breadcrumb Schema -->
    <script type="application/ld+json">
    @Html.Raw(@"{
        ""@context"": ""https://schema.org"",
        ""@type"": ""BreadcrumbList"",
        ""itemListElement"": [
            {
                ""@type"": ""ListItem"",
                ""position"": 1,
                ""name"": ""Home"",
                ""item"": ""https://wepper.vip4.link/""
            },
            {
                ""@type"": ""ListItem"", 
                ""position"": 2,
                ""name"": ""Conversor WebP"",
                ""item"": ""https://wepper.vip4.link/""
            }
        ]
    }")
    </script>

    <!-- Language Selector -->
    @await Html.PartialAsync("_LanguageSelector")
    
    <main id="main" role="main">
        @RenderBody()
    </main>

    <!-- Optimized JavaScript Loading -->
    <!-- Load critical JavaScript first -->
    <script>
        // Critical inline JS for immediate functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Add loading class for immediate feedback
            document.body.classList.add('js-loading');
            
            // Remove loading class when everything is loaded
            window.addEventListener('load', function() {
                document.body.classList.remove('js-loading');
                document.body.classList.add('js-loaded');
            });
        });
        
        // Performance observer for Core Web Vitals
        if ('PerformanceObserver' in window) {
            const observer = new PerformanceObserver((list) => {
                for (const entry of list.getEntries()) {
                    if (entry.entryType === 'largest-contentful-paint') {
                        console.log('LCP:', entry.startTime);
                    }
                    if (entry.entryType === 'first-input') {
                        console.log('FID:', entry.processingStart - entry.startTime);
                    }
                }
            });
            observer.observe({entryTypes: ['largest-contentful-paint', 'first-input']});
        }
    </script>
    
    <!-- Load JavaScript modules asynchronously -->
    <script async src="https://unpkg.com/feather-icons@latest/dist/feather.min.js"></script>
    <script defer src="~/lib/jquery/dist/jquery.min.js"></script>
    <script defer src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script defer src="~/js/site.js?v=@DateTime.Now.Ticks"></script>
    <script defer src="~/js/consent.js?v=@DateTime.Now.Ticks"></script>
    
    <!-- Initialize Feather icons when loaded -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for feather to load then initialize
            function initFeather() {
                if (typeof feather !== 'undefined') {
                    feather.replace();
                } else {
                    setTimeout(initFeather, 50);
                }
            }
            initFeather();
            
            // Register Service Worker for performance
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', function() {
                    navigator.serviceWorker.register('/sw.js')
                        .then(function(registration) {
                            console.log('ServiceWorker registrado com sucesso:', registration.scope);
                            
                            // Update available
                            registration.addEventListener('updatefound', function() {
                                const newWorker = registration.installing;
                                newWorker.addEventListener('statechange', function() {
                                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                        // Opcional: mostrar notificação de update
                                        console.log('Nova versão disponível');
                                    }
                                });
                            });
                        })
                        .catch(function(error) {
                            console.log('ServiceWorker falhou:', error);
                        });
                });
            }
        });
    </script>
    
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
